<!doctype HTML>
<html>
  <head>
    <title>jQuery document-viewer</title>
    <meta charset="utf-8" />
    <script src="package/JQuery_JS-virwer_showdown_x2j_json2.js"></script>
    <link href="package/jsonviewer.min.css" type="text/css" rel="stylesheet" />
	<link href="http://qalet.com/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
body {
  margin: 0 100px;
  font-family: sans-serif;
}

pre.doc_renderer {
 border: 1px solid #0B7500;
 border-top: 6px solid #0B7500; 
 margin-top:3px;
  padding: 1.5em;
}
pre.error { border: 1px solid red; border-top: 6px solid red; color: red; }	    
	    
    </style>
  </head>
  <body>
	<h1>Document viewer</h1>
	 <form>
		 <div class="container-fluid"  style="border:3px solid #0B7500;">
			<div class="row">
				<div class="col-sm-9">
					<div class="form-group">
					  <label for="comment">Data Source:</label>
					  <textarea class="form-control" rows="5" name="code"></textarea>
					</div>	

				</div>
				<div class="col-sm-3">
					<div class="form-group">
					  <label for="sel1">Data type:</label>
					  <select class="form-control" name="type">
						<option value="json">JSON</option>
						<option value="xml">XML</option>
						<option value="md">MarkDown</option>
					  </select>
					  <br/>
					  <button type="button" class="btn btn-default" onClick="sendForm()">Submit</button>
					</div>		
				</div>
			</div>
		</div>
	</form>
	
    <pre class="doc_renderer" id="doc-renderer"></pre>
	Sample:<br/>
	http://docviewer.qalet.com/README.md<br/>
	http://docviewer.qalet.com/api/data.js<br/>
	http://docviewer.qalet.com/data.xml	<br/>
   <script>
	   function sendForm() {
		var code  =   $('form').find("[name='code']").val(),
		    type =   $('form').find("[name='type']").val();
		var pattern = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;
        	
		   if (pattern.test(code)) {
            		$.get('http://docviewer.qalet.com/api/dataChannel.js',
				{url:code}, 
			     	function (data) {
					HtmlViwer(data, type, $('#doc-renderer')); 
				},'text'
			     );
           		 return true;
        	   } else {  
			HtmlViwer(code, type, $('#doc-renderer'));  
		   }

		console.log(code);   
	   };
	var HtmlViwer = function(data, type, target) {
		target.removeClass("error");
		if (type == 'md') {
			var converter = new showdown.Converter();
			target.html(converter.makeHtml(data));
		}	
		if (type == 'json') {
			var options = {
			  collapsed: false,
			  withQuotes: false
			};
			try{
				target.jsonViewer(JSON.parse(data), options);  
			} catch	(err) {
				target.addClass("error").html('Error! ' + err.message);	   
				}
			 
		}
		if (type == 'xml') {
			var x2js = new X2JS();
			var jsonObj = x2js.xml_str2json( data );
			console.log(jsonObj);
			var options = {
			  collapsed: false,
			  withQuotes: true
			};
			target.jsonViewer(jsonObj, options);  	
		}	 		
	};
    </script>
    
  </body>
</html>
